upstream {{ site_name }} {
        server unix:/var/run/{{ site_name }}-gunicorn.sock fail_timeout=0;
}

server {
        access_log /var/log/nginx/{{ site_name }}.access.log;
        error_log /var/log/nginx/{{ site_name }}.error.log;
        server_name {{ site_domain }};
 
        location /admin {
                rewrite ^(.*)$ https://{{ site_domain }}$1 permanent;
        }
 
        location ^/static {
                root {{ site_web_root }};
                expires 30d;
                #access_log off;
        }
        location / {
                proxy_set_header X-Forwarded-For $scheme;
                proxy_set_header Host $http_host;
                proxy_redirect off;
 
                if (!-f $request_filename) {
                        proxy_pass http://{{ site_name }};
                        break;
                }
        }
 
}
